{"version":3,"file":"Timer.js","sources":["../../../../../src/components/Timer/Timer.js"],"sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport memoize from 'lodash/memoize'\nimport dayjs from 'dayjs'\nimport { Redraw } from '../../providers/Redraw'\nimport { IconTime } from '../../icons'\nimport { GU, textStyle } from '../../style'\nimport { difference, formatHtmlDatetime } from '../../utils/date'\nimport { unselectable } from '../../utils'\nimport { useTheme } from '../../theme'\n\nconst RENDER_EVERY = 1000\n\nconst formatUnit = v => String(v).padStart(2, '0')\n\nconst formats = {\n  yMdhms: 'yMdhms',\n  yMdhm: 'yMdhm',\n  yMdh: 'yMdh',\n  yMd: 'yMd',\n  yM: 'yM',\n  Mdhms: 'Mdhms',\n  Mdhm: 'Mdhm',\n  Mdh: 'Mdh',\n  Md: 'Md',\n  dhms: 'dhms',\n  dhm: 'dhm',\n  hms: 'hms',\n  hm: 'hm',\n  ms: 'ms',\n  m: 'm',\n  s: 's',\n}\n\nconst unitNames = {\n  y: 'years',\n  M: 'months',\n  d: 'days',\n  h: 'hours',\n  m: 'minutes',\n  s: 'seconds',\n}\n\nconst getFormat = memoize(format =>\n  ['y', 'M', 'd', 'h', 'm', 's'].reduce(\n    (units, symbol) =>\n      formats[format].includes(symbol) ? [...units, unitNames[symbol]] : units,\n    []\n  )\n)\n\nfunction getTime(start, end, format, showEmpty, maxUnits) {\n  const date1 = end || new Date()\n  const date2 = end ? new Date() : start\n\n  const totalInSeconds = dayjs(date1).diff(date2, 'seconds')\n\n  const { years, months, days, hours, minutes, seconds } = difference(\n    date1,\n    date2,\n    { keepLeadingZeros: showEmpty, maxUnits, units: getFormat(format) }\n  )\n\n  return {\n    units: [\n      ['Y', years],\n      ['M', months],\n      ['D', days],\n      ['H', hours],\n      ['M', minutes],\n      ['S', seconds],\n    ],\n    totalInSeconds,\n  }\n}\n\nclass Timer extends React.Component {\n  static propTypes = {\n    end: PropTypes.instanceOf(Date),\n    format: PropTypes.oneOf(Object.keys(formats)),\n    maxUnits: PropTypes.number,\n    showEmpty: PropTypes.bool,\n    showIcon: PropTypes.bool,\n    start: PropTypes.instanceOf(Date),\n    theme: PropTypes.object,\n  }\n  static defaultProps = {\n    format: formats.yMdhms,\n    maxUnits: -1,\n    showEmpty: false,\n    showIcon: true,\n  }\n\n  render() {\n    const { end, start, showIcon, theme } = this.props\n    return (\n      <time\n        dateTime={formatHtmlDatetime(end || start)}\n        css={`\n          display: flex;\n          align-items: center;\n          white-space: nowrap;\n          ${unselectable()};\n          ${textStyle('body2')};\n        `}\n      >\n        {showIcon && (\n          <span\n            css={`\n              display: flex;\n              align-items: center;\n              margin-right: ${0.5 * GU}px;\n              margin-top: -3px;\n            `}\n          >\n            <IconTime\n              css={`\n                color: ${theme.surfaceIcon};\n              `}\n            />\n          </span>\n        )}\n        <Redraw interval={RENDER_EVERY}>{this.renderTime}</Redraw>\n      </time>\n    )\n  }\n\n  renderTime = () => {\n    const { start, end, theme, format, showEmpty, maxUnits } = this.props\n\n    const { totalInSeconds, units } = getTime(\n      start,\n      end,\n      format,\n      showEmpty,\n      maxUnits\n    )\n\n    if (totalInSeconds < 0 || Object.is(totalInSeconds, -0)) {\n      return (\n        <span\n          css={`\n            ${textStyle('body2')};\n            color: ${theme.surfaceContentSecondary};\n          `}\n        >\n          {end ? 'Time out' : '−'}\n        </span>\n      )\n    }\n\n    const lastUnitIndex = units.reduce(\n      (lastIndex, unit, index) => (unit[1] === null ? lastIndex : index),\n      0\n    )\n\n    return (\n      <span>\n        {units.map((unit, index) => {\n          const isLast = index === lastUnitIndex\n          const isSeconds = index === units.length - 1\n\n          // Only time units (hours, minutes and seconds).\n          // Remember to update if ms gets added one day!\n          const isTimeUnit = index >= units.length - 3\n\n          if (unit[1] === null) {\n            return null\n          }\n\n          return (\n            <React.Fragment key={index}>\n              <span\n                css={`\n                  color: ${theme.surfaceContent};\n\n                  ${isSeconds &&\n                    // Fix the width of the seconds unit so that\n                    // it doesn’t jump too much.\n                    `\n                      display: inline-flex;\n                      align-items: baseline;\n                      justify-content: space-between;\n                      min-width: 31px;\n                    `};\n                `}\n              >\n                {formatUnit(unit[1])}\n                <span\n                  css={`\n                    margin-left: 2px;\n                    color: ${theme.surfaceContentSecondary};\n                  `}\n                >\n                  {unit[0]}\n                </span>\n              </span>\n              {!isLast && (\n                // Separator\n                <span\n                  css={`\n                    margin: 0 4px;\n                    color: ${theme.surfaceContentSecondary};\n                    font-weight: 400;\n                  `}\n                >\n                  {isTimeUnit && ':'}\n                </span>\n              )}\n            </React.Fragment>\n          )\n        })}\n      </span>\n    )\n  }\n}\n\nexport default props => {\n  const theme = useTheme()\n  return <Timer {...props} theme={theme} />\n}\n"],"names":["RENDER_EVERY","formatUnit","v","String","padStart","formats","yMdhms","yMdhm","yMdh","yMd","yM","Mdhms","Mdhm","Mdh","Md","dhms","dhm","hms","hm","ms","m","s","unitNames","y","M","d","h","getFormat","memoize","format","reduce","units","symbol","includes","getTime","start","end","showEmpty","maxUnits","date1","Date","date2","totalInSeconds","dayjs","diff","difference","keepLeadingZeros","years","months","days","hours","minutes","seconds","Timer","props","theme","Object","is","textStyle","surfaceContentSecondary","lastUnitIndex","lastIndex","unit","index","map","isLast","isSeconds","length","isTimeUnit","surfaceContent","showIcon","formatHtmlDatetime","unselectable","GU","surfaceIcon","renderTime","React","Component","PropTypes","instanceOf","oneOf","keys","number","bool","object","useTheme"],"mappings":"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"}