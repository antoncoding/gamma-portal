{"version":3,"file":"Popover.js","sources":["../../../../../src/components/Popover/Popover.js"],"sourcesContent":["import React from 'react'\nimport PropTypes from '../../proptypes'\nimport Popper from 'popper.js'\nimport { Transition, animated } from 'react-spring'\nimport { useRoot } from '../../providers'\nimport { springs, GU, RADIUS } from '../../style'\nimport { useTheme } from '../../theme'\nimport { noop, stylingProps, warn, KEY_ESC } from '../../utils'\nimport RootPortal from '../RootPortal/RootPortal'\n\nclass PopoverBase extends React.Component {\n  static propTypes = {\n    children: PropTypes.node,\n    closeOnOpenerFocus: PropTypes.bool,\n    onClose: PropTypes.func,\n    opener: PropTypes._element,\n    placement: PropTypes.oneOf(\n      // \"center\" is a value that doesn’t exist in Popper, but we are using it\n      // to define custom Popper settings (see getPopperSettings() below).\n      ['center'].concat(\n        ...['auto', 'top', 'right', 'bottom', 'left'].map(position => [\n          position,\n          `${position}-start`,\n          `${position}-end`,\n        ])\n      )\n    ),\n    rootBoundary: PropTypes._element,\n    theme: PropTypes.object,\n    transitionStyles: PropTypes.object,\n    zIndex: PropTypes.number,\n  }\n\n  static defaultProps = {\n    closeOnOpenerFocus: false,\n    opener: null,\n    placement: 'center',\n    onClose: noop,\n    zIndex: 999,\n  }\n\n  _cardElement = React.createRef()\n  _popperElement = React.createRef()\n  _document = null\n  _popper = null\n\n  componentDidMount() {\n    this._document = this._popperElement.current.ownerDocument\n    this._document.addEventListener('keydown', this.handleEscape)\n    this.focus()\n    this.initPopper()\n  }\n\n  componentWillUnmount() {\n    this.destroyPopper()\n    this._document.removeEventListener('keydown', this.handleEscape)\n    delete this._document\n    delete this._popper\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    const { placement, children, opener } = this.props\n    if (\n      prevProps.placement !== placement ||\n      prevProps.children !== children ||\n      prevProps.opener !== opener\n    ) {\n      this.destroyPopper()\n      this.initPopper()\n    }\n  }\n\n  focus() {\n    if (this._cardElement.current) {\n      this._cardElement.current.focus()\n    }\n  }\n\n  getPopperSettings() {\n    const { placement, rootBoundary } = this.props\n\n    const settings = {\n      placement,\n      modifiers: {\n        preventOverflow: {\n          enabled: true,\n          padding: 10,\n          boundariesElement: rootBoundary || 'window',\n        },\n      },\n      positionFixed: false,\n    }\n\n    if (placement !== 'center') {\n      return settings\n    }\n\n    return {\n      ...settings,\n      placement: 'top-start',\n      modifiers: {\n        ...settings.modifiers,\n        arrow: { enabled: false },\n        flip: { enabled: false },\n        offset: { enabled: true, offset: '50% - 50%p, -50%p - 50%' },\n      },\n    }\n  }\n\n  initPopper() {\n    const { opener } = this.props\n    if (!this._popper) {\n      this._popper = new Popper(\n        opener,\n        this._popperElement.current,\n        this.getPopperSettings()\n      )\n    }\n  }\n\n  destroyPopper() {\n    if (this._popper) {\n      this._popper.destroy()\n      this._popper = null\n    }\n  }\n\n  handleEscape = ({ keyCode }) => {\n    if (keyCode === KEY_ESC) {\n      // On escape, we always move the focus back to the opener.\n      this.props.opener.focus()\n      this.attemptClose()\n    }\n  }\n\n  handleBlur = event => {\n    const { closeOnOpenerFocus, opener } = this.props\n    const focusedElement = event.relatedTarget\n\n    // Do not close if:\n    // - The blur event is emitted from an element inside of the popover.\n    // - The focused target is the opener and closeOnOpenerFocus is true.\n    if (\n      (this._cardElement.current &&\n        this._cardElement.current.contains(focusedElement)) ||\n      (closeOnOpenerFocus && opener && opener.contains(focusedElement))\n    ) {\n      if (\n        closeOnOpenerFocus &&\n        (opener.tagName === 'BUTTON' || opener.tagName === 'INPUT')\n      ) {\n        warn(\n          'Popover: using \"closeOnOpenerFocus\" with a <button> or <input> may lead to bugs due ' +\n            'to cross-environment focus event handling. ' +\n            'See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus ' +\n            'for more information.'\n        )\n      }\n      return\n    }\n\n    // Probably a click outside, that doesn’t focus anything else: move the\n    // focus back to the opener.\n    if (!focusedElement) {\n      opener.focus()\n    }\n    this.attemptClose()\n  }\n\n  attemptClose() {\n    const accepted = this.props.onClose()\n\n    // If closing the popover is not accepted, we need to focus it again so\n    // that it can react to onBlur events.\n    if (accepted === false) {\n      this.focus()\n    }\n  }\n\n  boundaryDimensions() {\n    const { rootBoundary } = this.props\n    const hasWindow = typeof window !== 'undefined'\n    return rootBoundary\n      ? [rootBoundary.clientWidth, rootBoundary.clientHeight]\n      : [hasWindow ? window.innerWidth : 0, hasWindow ? window.innerHeight : 0]\n  }\n\n  render() {\n    const { children, theme, transitionStyles, zIndex } = this.props\n    const { scale, opacity } = transitionStyles\n    const [maxWidth, maxHeight] = this.boundaryDimensions()\n    return (\n      <animated.div\n        css={`\n          // default styles until Popper takes over\n          position: absolute;\n          top: 0;\n          left: 0;\n        `}\n        ref={this._popperElement}\n        style={{ zIndex }}\n      >\n        <animated.div\n          tabIndex=\"0\"\n          onBlur={this.handleBlur}\n          ref={this._cardElement}\n          style={{\n            opacity,\n            transform: scale.interpolate(v => `scale3d(${v}, ${v}, 1)`),\n            maxHeight: `${maxHeight - 2 * GU}px`,\n            maxWidth: `${maxWidth - 2 * GU}px`,\n          }}\n          css={`\n            background: ${theme.surface};\n            border: 1px solid ${theme.border};\n            border-radius: ${RADIUS}px;\n            filter: drop-shadow(0 4px 4px rgba(0, 0, 0, 0.15));\n            &:focus {\n              /* Having the popover visible already means that it focused. */\n              outline: 0;\n            }\n            overflow-y: auto;\n          `}\n          {...stylingProps(this)}\n        >\n          {children}\n        </animated.div>\n      </animated.div>\n    )\n  }\n}\n\nfunction Popover({ scaleEffect, visible, ...props }) {\n  const theme = useTheme()\n  const root = useRoot()\n\n  return (\n    <RootPortal>\n      <Transition\n        items={visible}\n        config={springs.swift}\n        from={{ scale: scaleEffect ? 0.9 : 1, opacity: 0 }}\n        enter={{ scale: 1, opacity: 1 }}\n        leave={{ scale: scaleEffect ? 0.9 : 1, opacity: 0 }}\n        native\n      >\n        {visible =>\n          visible &&\n          (transitionStyles => (\n            <PopoverBase\n              {...props}\n              rootBoundary={root}\n              theme={theme}\n              transitionStyles={transitionStyles}\n            />\n          ))\n        }\n      </Transition>\n    </RootPortal>\n  )\n}\n\nPopover.propTypes = {\n  ...PopoverBase.propTypes,\n  scaleEffect: PropTypes.bool,\n  visible: PropTypes.bool,\n}\n\nPopover.defaultProps = {\n  ...PopoverBase.defaultProps,\n  scaleEffect: true,\n  visible: true,\n}\n\nexport default Popover\n"],"names":["RADIUS","PopoverBase","React","createRef","keyCode","KEY_ESC","props","opener","focus","attemptClose","event","closeOnOpenerFocus","focusedElement","relatedTarget","_cardElement","current","contains","tagName","warn","_document","_popperElement","ownerDocument","addEventListener","handleEscape","initPopper","destroyPopper","removeEventListener","_popper","prevProps","prevState","placement","children","rootBoundary","settings","modifiers","preventOverflow","enabled","padding","boundariesElement","positionFixed","arrow","flip","offset","Popper","getPopperSettings","destroy","accepted","onClose","hasWindow","window","clientWidth","clientHeight","innerWidth","innerHeight","theme","transitionStyles","zIndex","scale","opacity","boundaryDimensions","maxWidth","maxHeight","handleBlur","transform","interpolate","v","GU","stylingProps","surface","border","Component","PropTypes","node","bool","func","_element","oneOf","concat","map","position","object","number","noop","Popover","scaleEffect","visible","useTheme","root","useRoot","springs","swift","propTypes","defaultProps"],"mappings":"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"}