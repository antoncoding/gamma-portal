{"version":3,"file":"ToastHub.js","sources":["../../../../../src/components/ToastHub/ToastHub.js"],"sourcesContent":["import React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { animated, Transition } from 'react-spring'\nimport RootPortal from '../RootPortal/RootPortal'\nimport { useViewport } from '../../providers/Viewport/Viewport'\nimport { stylingProps } from '../../utils'\nimport { useTheme } from '../../theme'\nimport { springs, textStyle, GU, RADIUS } from '../../style'\n\nlet id = 0\n\nconst move = pixel => `translate3d(0,${pixel}px,0)`\n\nexport const ToastContext = React.createContext(() => {\n  throw new Error(\n    \"For Toast to work it needs to be part of a ToastHub's tree, which has to be declared at an upper level!\"\n  )\n})\n\nclass ToastHubProvider extends React.PureComponent {\n  static propTypes = {\n    children: PropTypes.node,\n    position: PropTypes.PropTypes.oneOf(['left', 'center', 'right']),\n    shift: PropTypes.number,\n    showIndicator: PropTypes.bool,\n    threshold: PropTypes.number,\n    timeout: PropTypes.number,\n    top: PropTypes.bool,\n  }\n\n  static defaultProps = {\n    position: 'right',\n    showIndicator: false,\n    threshold: Infinity,\n    timeout: 4000,\n    top: false,\n  }\n\n  state = { items: [], leaving: [], preLeaving: [] }\n\n  cancelMap = new WeakMap()\n\n  add = msg => {\n    const threshold = this.props.threshold\n    this.setState(state => {\n      // This calls cancel on all leaving animations that stack up too much\n      if (threshold !== Infinity) {\n        state.leaving\n          .slice(threshold - 1)\n          .forEach(item => this.cancel(item, true))\n      }\n      return { items: [...state.items, { key: id++, msg }], preLeaving: [] }\n    })\n  }\n\n  remove = item => {\n    this.setState(state => ({\n      items: state.items.filter(i => i.key !== item.key),\n      leaving: state.leaving.includes(item)\n        ? state.leaving\n        : [item, ...state.leaving],\n    }))\n  }\n\n  config = (item, state) => {\n    const config = springs.lazy\n    // Return custom configs on leave (includes the life-line duration)\n    return state === 'leave'\n      ? [{ duration: this.props.timeout }, config, config]\n      : config\n  }\n\n  cancel = (item, secondPass = false) => {\n    if (this.cancelMap.has(item)) {\n      const fn = this.cancelMap.get(item)\n      fn()\n      // There are 3 passes: lifeline, opacity->0, height->0\n      if (secondPass) fn()\n    }\n  }\n\n  leave = item => async (next, cancel) => {\n    // Save cancel so that it can be used interactively\n    this.cancelMap.set(item, cancel)\n\n    // Lifeline first\n    await next({ to: { life: '0%' } })\n\n    // Add to the pre-leaving list, to know when there are no more toasts\n    // displayed even though they are still finishing their leaving transition.\n    this.setState(state => ({\n      preLeaving: [...state.preLeaving, item],\n    }))\n\n    // Then fade out\n    await next({ to: { opacity: 0 } })\n\n    // Then shrink, the last \"true\" informs Keyframes that is is the last frame\n    await next({ to: { height: 0 } }, true)\n\n    this.setState(state => ({\n      leaving: state.leaving.filter(i => i.key !== item.key),\n      preLeaving: state.preLeaving.filter(i => i.key !== item.key),\n    }))\n  }\n\n  render() {\n    const { children, showIndicator, position, top, shift } = this.props\n    const { items, leaving, preLeaving } = this.state\n\n    const renderList = items.length > 0 || leaving.length > 0\n    const itemsVisible =\n      leaving.length === preLeaving.length && leaving.length > 0\n        ? false\n        : renderList\n\n    return (\n      <React.Fragment>\n        <ToastContext.Provider\n          value={{\n            itemsVisible,\n            add: this.add,\n          }}\n        >\n          {children}\n        </ToastContext.Provider>\n        {renderList && (\n          <RootPortal>\n            <ToastList\n              config={this.config}\n              items={items}\n              leave={this.leave}\n              position={position}\n              remove={this.remove}\n              showIndicator={showIndicator}\n              top={top}\n              {...stylingProps(this)}\n              shift={shift}\n            />\n          </RootPortal>\n        )}\n      </React.Fragment>\n    )\n  }\n}\n\n// ToastList is separated from ToastHubProvider so we can skip its rendering\nconst ToastList = React.memo(function ToastList({\n  config,\n  items,\n  leave,\n  position,\n  remove,\n  showIndicator,\n  top,\n  shift,\n  ...props\n}) {\n  const theme = useTheme()\n  const { below } = useViewport()\n  const spacing = below('medium') ? 2 * GU : 3 * GU\n  return (\n    <div\n      css={`\n        position: fixed;\n        z-index: 1000;\n        top: ${top ? `${spacing}px` : 'unset'};\n        bottom: ${top ? 'unset' : `${spacing}px`};\n        left: ${spacing + (shift || 0)}px;\n        right: ${spacing + (shift || 0)}px;\n        display: flex;\n        margin: 0 auto;\n        flex-direction: ${top ? 'column-reverse' : 'column'};\n        pointer-events: none;\n        align-items: ${(() => {\n          if (below('medium')) return 'center'\n          if (position === 'left') return 'flex-start'\n          if (position === 'right') return 'flex-end'\n          return 'center'\n        })()};\n      `}\n      {...props}\n    >\n      <Transition\n        native\n        items={items}\n        keys={item => item.key}\n        from={{ opacity: 0, height: 0, life: '100%', transform: move(30) }}\n        enter={{ opacity: 1, height: 'auto', transform: move(0) }}\n        leave={leave}\n        onRest={remove}\n        config={config}\n      >\n        {item =>\n          /* eslint-disable react/prop-types */\n          ({ life, ...props }) => (\n            <animated.div\n              style={props}\n              css={`\n                box-sizing: border-box;\n                position: relative;\n                width: ${below('medium') ? '100%' : '42ch'};\n              `}\n            >\n              <div\n                css={`\n                  display: flex;\n                  align-items: center;\n                  overflow: hidden;\n                  height: ${6 * GU}px;\n                  margin-top: ${top ? '0' : `${1.25 * GU}px`};\n                  margin-bottom: ${top ? `${1.25 * GU}px` : '0'};\n                  padding: 0 ${2.5 * GU}px;\n                  ${textStyle('body3')};\n                  color: ${theme.floatingContent};\n                  background: ${theme.floating.alpha(0.95)};\n                  border-radius: ${RADIUS}px;\n                `}\n              >\n                {showIndicator && (\n                  <animated.div\n                    style={{ right: life }}\n                    css={`\n                      position: absolute;\n                      bottom: ${top ? `${1.25 * GU}px` : '0'};\n                      left: 0;\n                      width: auto;\n                      height: 5px;\n                      background-image: linear-gradient(\n                        130deg,\n                        #00b4e6,\n                        #00f0e0\n                      );\n                    `}\n                  />\n                )}\n                <p>{item.msg}</p>\n              </div>\n            </animated.div>\n          )\n        /* eslint-enable react/prop-types */\n        }\n      </Transition>\n    </div>\n  )\n})\n\nToastList.propTypes = {\n  config: PropTypes.func,\n  items: PropTypes.array,\n  leave: PropTypes.func,\n  position: PropTypes.PropTypes.oneOf(['left', 'center', 'right']),\n  remove: PropTypes.func,\n  shift: PropTypes.number,\n  showIndicator: PropTypes.bool,\n  top: PropTypes.bool,\n}\n\nconst useToast = () => useContext(ToastContext).add\nconst Toast = props => props.children(useToast())\n\nexport default ToastHubProvider\nexport { Toast, useToast }\n"],"names":["id","move","pixel","ToastContext","React","createContext","Error","ToastHubProvider","items","leaving","preLeaving","WeakMap","msg","threshold","props","setState","state","Infinity","slice","forEach","item","cancel","key","filter","i","includes","config","springs","lazy","duration","timeout","secondPass","cancelMap","has","fn","get","next","set","to","life","opacity","height","children","showIndicator","position","top","shift","renderList","length","itemsVisible","add","leave","remove","stylingProps","PureComponent","PropTypes","node","oneOf","number","bool","RADIUS","ToastList","memo","theme","useTheme","useViewport","below","spacing","GU","transform","textStyle","floatingContent","floating","alpha","right","propTypes","func","array","useToast","useContext","Toast"],"mappings":"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"}