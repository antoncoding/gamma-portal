{"version":3,"file":"DateRangePicker.js","sources":["../../../../../src/components/DateRangePicker/DateRangePicker.js"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport dayjs from 'dayjs'\nimport Button from '../Button/Button'\nimport { useViewport } from '../../providers/Viewport/Viewport'\nimport { GU, RADIUS } from '../../style'\nimport { useTheme } from '../../theme'\nimport DatePicker from './DatePicker'\nimport Labels from './Labels'\nimport { START_DATE, END_DATE } from './consts'\nimport { handleDateSelect } from './utils'\nimport Popover from '../Popover/Popover'\n\nfunction DateRangePicker({\n  format,\n  endDate: endDateProp,\n  onChange,\n  startDate: startDateProp,\n}) {\n  const theme = useTheme()\n  const labelsRef = useRef()\n  const [showPicker, setShowPicker] = useState(false)\n  const [startDate, setStartDate] = useState(startDateProp)\n  const [endDate, setEndDate] = useState(endDateProp)\n\n  // on closing the picked, reset state\n  useEffect(() => {\n    if (!showPicker) {\n      setStartDate(startDateProp)\n      setEndDate(endDateProp)\n    }\n  }, [endDateProp, startDateProp, showPicker])\n\n  const handlePopoverClose = useCallback(() => setShowPicker(false), [])\n\n  const handleLabelsClick = useCallback(() => {\n    setShowPicker(show => !show)\n  }, [])\n\n  const handleDateClick = useCallback(\n    date => {\n      const result = handleDateSelect({ date, startDate, endDate })\n      result.startDate !== undefined && setStartDate(result.startDate)\n      result.endDate !== undefined && setEndDate(result.endDate)\n    },\n    [startDate, endDate]\n  )\n\n  const handleApply = useCallback(() => {\n    setShowPicker(false)\n\n    if (startDate && endDate) {\n      onChange({\n        start: dayjs(startDate)\n          .startOf('day')\n          .toDate(),\n        end: dayjs(endDate)\n          .endOf('day')\n          .toDate(),\n      })\n    }\n  }, [endDate, onChange, startDate])\n\n  const handleClear = useCallback(() => {\n    setStartDate(null)\n    setEndDate(null)\n    setShowPicker(false)\n    onChange({ start: null, end: null })\n  }, [onChange])\n\n  const labelProps = useMemo(() => {\n    const _startDate = showPicker ? startDate : startDateProp\n    const _endDate = showPicker ? endDate : endDateProp\n    return {\n      startText: _startDate ? dayjs(_startDate).format(format) : START_DATE,\n      endText: _endDate ? dayjs(_endDate).format(format) : END_DATE,\n    }\n  }, [endDate, endDateProp, format, showPicker, startDate, startDateProp])\n\n  const compactMode = useViewport().below('medium')\n\n  const displayMonthBeforeOnLeft = useMemo(() => {\n    // If both dates are in the same month, use the right calendar\n    // for it, and display month before on the left calendar.\n    const propsDatesInSameMonth =\n      startDateProp &&\n      endDateProp &&\n      dayjs(startDateProp).isSame(dayjs(endDateProp), 'month')\n\n    return !compactMode && (propsDatesInSameMonth || !startDateProp)\n  }, [compactMode, endDateProp, startDateProp])\n\n  return (\n    <div>\n      <Labels\n        ref={labelsRef}\n        enabled={showPicker}\n        hasSetDates={Boolean(startDateProp && endDateProp)}\n        onClick={handleLabelsClick}\n        {...labelProps}\n      />\n      <Popover\n        closeOnOpenerFocus\n        onClose={handlePopoverClose}\n        opener={labelsRef.current}\n        placement=\"bottom-start\"\n        visible={showPicker}\n        css={`\n          min-width: ${37.5 * GU + 2}px;\n          border: 0;\n          filter: none;\n          background: none;\n          margin: 2px 0 0 0;\n        `}\n      >\n        <div\n          css={`\n            padding: ${2.5 * GU}px ${3 * GU}px ${3 * GU}px;\n            border: 1px solid ${theme.border};\n            border-radius: ${RADIUS}px;\n            background: ${theme.surface};\n          `}\n        >\n          <div\n            css={`\n              display: flex;\n              flex-direction: row;\n              align-items: baseline;\n            `}\n          >\n            <DatePicker\n              datesRangeEnd={endDate}\n              datesRangeStart={startDate}\n              initialDate={dayjs(startDateProp || undefined)\n                .subtract(displayMonthBeforeOnLeft ? 1 : 0, 'month')\n                .toDate()}\n              onSelect={handleDateClick}\n            />\n            {!compactMode && (\n              <DatePicker\n                datesRangeEnd={endDate}\n                datesRangeStart={startDate}\n                initialDate={dayjs(endDateProp || undefined).toDate()}\n                onSelect={handleDateClick}\n                css={`\n                  margin-left: ${1 * GU}px;\n                `}\n              />\n            )}\n          </div>\n\n          <div\n            css={`\n              display: flex;\n              align-items: center;\n              justify-content: space-between;\n              margin-top: ${GU * 2.25}px;\n\n              ${compactMode\n                ? ''\n                : `\n                    max-width: 247px;\n                    margin-left: auto;\n                  `};\n            `}\n          >\n            <Button onClick={handleClear} size=\"small\" wide>\n              Reset\n            </Button>\n            <Button\n              disabled={!startDate || !endDate}\n              mode=\"strong\"\n              onClick={handleApply}\n              size=\"small\"\n              wide\n              css={`\n                margin-left: ${1.5 * GU}px;\n              `}\n            >\n              Apply\n            </Button>\n          </div>\n        </div>\n      </Popover>\n    </div>\n  )\n}\n\nDateRangePicker.propTypes = {\n  endDate: PropTypes.instanceOf(Date),\n  format: PropTypes.string,\n  onChange: PropTypes.func,\n  startDate: PropTypes.instanceOf(Date),\n}\n\nDateRangePicker.defaultProps = {\n  format: 'MM/DD/YYYY',\n  onChange: () => {},\n}\n\nexport default DateRangePicker\n"],"names":["RADIUS","DateRangePicker","format","endDateProp","endDate","onChange","startDateProp","startDate","theme","useTheme","labelsRef","useRef","useState","showPicker","setShowPicker","setStartDate","setEndDate","useEffect","handlePopoverClose","useCallback","handleLabelsClick","show","handleDateClick","date","result","handleDateSelect","undefined","handleApply","start","dayjs","startOf","toDate","end","endOf","handleClear","labelProps","useMemo","_startDate","_endDate","startText","START_DATE","endText","END_DATE","compactMode","useViewport","below","displayMonthBeforeOnLeft","propsDatesInSameMonth","isSame","Boolean","current","GU","border","surface","subtract","Button","propTypes","PropTypes","instanceOf","Date","string","func","defaultProps"],"mappings":"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"}