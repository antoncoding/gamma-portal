{"version":3,"file":"Viewport.js","sources":["../../../../../src/providers/Viewport/Viewport.js"],"sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport { BREAKPOINTS } from '../../style'\nimport throttle from 'lodash/throttle'\n\nconst NO_DOM_WINDOW_SIZE = { width: 0, height: 0 }\n\nconst WINDOW_SIZE_BASE = { breakpoints: BREAKPOINTS, ...getCurrentWindowSize() }\n\nconst ViewportContext = React.createContext(WINDOW_SIZE_BASE)\n\nfunction getCurrentWindowSize() {\n  return typeof window === 'undefined'\n    ? NO_DOM_WINDOW_SIZE\n    : { width: window.innerWidth, height: window.innerHeight }\n}\n\nclass ViewportProvider extends React.Component {\n  static propTypes = {\n    children: PropTypes.node,\n    throttle: PropTypes.number,\n  }\n\n  static defaultProps = {\n    throttle: 100,\n  }\n\n  state = { windowSize: this.getWindowSize() }\n\n  componentDidMount() {\n    this.resizeStart()\n  }\n\n  componentWillUnmount() {\n    this.resizeStop()\n  }\n\n  componentDidUpdate(prevProps) {\n    const { throttle } = this.props\n    if (prevProps.throttle !== throttle) {\n      this.resizeStop()\n      this.resizeStart()\n    }\n  }\n\n  resizeStart() {\n    this._handleResize = throttle(this.updateWindowSize, this.props.throttle)\n    this.updateWindowSize()\n\n    if (typeof window !== 'undefined') {\n      window.addEventListener('resize', this._handleResize)\n    }\n  }\n\n  resizeStop() {\n    if (!this._handleResize) {\n      return\n    }\n    if (typeof window !== 'undefined') {\n      window.removeEventListener('resize', this._handleResize)\n    }\n    this._handleResize.cancel()\n    delete this._handleResize\n  }\n\n  updateWindowSize = () => {\n    this.setState({ windowSize: this.getWindowSize() })\n  }\n\n  getWindowSize() {\n    return {\n      ...WINDOW_SIZE_BASE,\n      ...getCurrentWindowSize(),\n    }\n  }\n\n  // Check if the current width is between two points.\n  // Accepts a breakpoint string ('small', 'large') or numbers (width in pixels).\n  // `min` is inclusive and `max` is exclusive.\n  within = (min, max) => {\n    const { width } = this.state.windowSize\n\n    // Accept \"\" or -1 indifferently\n    if (min === '') min = -1\n    if (max === '') max = -1\n\n    // Convert breakpoints into numbers\n    if (typeof min === 'string') min = BREAKPOINTS[min]\n    if (typeof max === 'string') max = BREAKPOINTS[max]\n\n    if (typeof min !== 'number') {\n      throw new Error(`Viewport: invalid minimum value (${min}).`)\n    }\n    if (typeof max !== 'number') {\n      throw new Error(`Viewport: invalid maximum value (${max}).`)\n    }\n\n    return (min === -1 || width >= min) && (max === -1 || width < max)\n  }\n\n  above = value => this.within(value, -1)\n  below = value => this.within(-1, value)\n\n  render() {\n    const { windowSize } = this.state\n    const { children } = this.props\n    const { within, above, below } = this\n    return (\n      <ViewportContext.Provider value={{ ...windowSize, within, above, below }}>\n        {children}\n      </ViewportContext.Provider>\n    )\n  }\n}\n\n// React emits a warning message if `Provider` is attached to `Consumer`, this\n// is only to prevent it.\nconst Viewport = props => <ViewportContext.Consumer {...props} />\n\nViewport.Provider = ViewportProvider\n\nexport const useViewport = () => React.useContext(ViewportContext)\nexport { Viewport }\nexport default Viewport\n"],"names":["NO_DOM_WINDOW_SIZE","width","height","WINDOW_SIZE_BASE","breakpoints","BREAKPOINTS","getCurrentWindowSize","ViewportContext","React","createContext","window","innerWidth","innerHeight","ViewportProvider","windowSize","getWindowSize","setState","min","max","state","Error","value","within","resizeStart","resizeStop","prevProps","throttle","props","_handleResize","updateWindowSize","addEventListener","removeEventListener","cancel","children","above","below","Component","PropTypes","node","number","Viewport","Provider","useViewport","useContext"],"mappings":"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"}